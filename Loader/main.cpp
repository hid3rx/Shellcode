#include <stdio.h>
#include <Windows.h>

BYTE shellcode[] = {
    0x65,0x48,0x8b,0x04,0x25,0x30,0x00,0x00,0x00,0x48,0x8b,0x40,0x60,0x48,0x8b,0x40,
    0x18,0x4c,0x8b,0x40,0x20,0x4c,0x89,0xc0,0xeb,0x0f,0x66,0x0f,0x1f,0x44,0x00,0x00,
    0x49,0x39,0xc0,0x0f,0x84,0x7d,0x01,0x00,0x00,0x48,0x8b,0x00,0x48,0x8b,0x48,0x40,
    0x0f,0xb7,0x51,0x28,0x83,0xe2,0xdf,0x66,0x83,0xfa,0x4b,0x75,0xe3,0x66,0x83,0x79,
    0x34,0x33,0x75,0xdc,0x66,0x83,0x79,0x36,0x32,0x75,0xd5,0x55,0x45,0x31,0xc9,0x31,
    0xd2,0x57,0x56,0x53,0x48,0x83,0xec,0x28,0x4c,0x8b,0x58,0x20,0x49,0x63,0x43,0x3c,
    0x42,0x8b,0xb4,0x18,0x88,0x00,0x00,0x00,0x4c,0x01,0xde,0x44,0x8b,0x56,0x20,0x8b,
    0x7e,0x1c,0x8b,0x5e,0x18,0x4d,0x01,0xda,0x4c,0x01,0xdf,0x48,0x89,0xdd,0x85,0xdb,
    0x74,0x68,0x66,0x0f,0x1f,0x44,0x00,0x00,0x41,0x8b,0x0a,0x4c,0x01,0xd9,0x0f,0xbe,
    0x01,0x84,0xc0,0x74,0x2a,0x45,0x31,0xc0,0x0f,0x1f,0x84,0x00,0x00,0x00,0x00,0x00,
    0x44,0x89,0xc2,0x48,0x83,0xc1,0x01,0xc1,0xe2,0x05,0x01,0xd0,0x41,0x01,0xc0,0x0f,
    0xbe,0x01,0x84,0xc0,0x75,0xea,0x41,0x81,0xf8,0x76,0x2c,0x1d,0x07,0x74,0x1a,0x41,
    0x8d,0x41,0x01,0x49,0x83,0xc1,0x01,0x49,0x83,0xc2,0x04,0x4c,0x39,0xcb,0x75,0xb8,
    0x31,0xd2,0x39,0xc5,0x74,0x14,0x41,0x89,0xc1,0x8b,0x46,0x24,0x4b,0x8d,0x14,0x4b,
    0x0f,0xb7,0x04,0x02,0x8b,0x14,0x87,0x4c,0x01,0xda,0x48,0x8d,0x0d,0xcf,0x00,0x00,
    0x00,0xff,0xd2,0x49,0x89,0xc3,0x48,0x63,0x40,0x3c,0x42,0x8b,0xb4,0x18,0x88,0x00,
    0x00,0x00,0x4c,0x01,0xde,0x44,0x8b,0x56,0x20,0x8b,0x7e,0x18,0x4d,0x01,0xda,0x85,
    0xff,0x0f,0x84,0x8a,0x00,0x00,0x00,0x89,0xfb,0x45,0x31,0xc9,0x0f,0x1f,0x40,0x00,
    0x41,0x8b,0x0a,0x4c,0x01,0xd9,0x0f,0xbe,0x01,0x84,0xc0,0x74,0x22,0x45,0x31,0xc0,
    0x44,0x89,0xc2,0x48,0x83,0xc1,0x01,0xc1,0xe2,0x05,0x01,0xd0,0x41,0x01,0xc0,0x0f,
    0xbe,0x01,0x84,0xc0,0x75,0xea,0x41,0x81,0xf8,0xcf,0x4c,0xe5,0x4c,0x74,0x1b,0x41,
    0x8d,0x41,0x01,0x49,0x83,0xc1,0x01,0x49,0x83,0xc2,0x04,0x4c,0x39,0xcb,0x75,0xc0,
    0x45,0x31,0xd2,0x39,0xc7,0x74,0x1c,0x41,0x89,0xc1,0x8b,0x56,0x24,0x4b,0x8d,0x0c,
    0x4b,0x8b,0x46,0x1c,0x0f,0xb7,0x14,0x11,0x49,0x8d,0x14,0x93,0x44,0x8b,0x14,0x02,
    0x4d,0x01,0xda,0x48,0x83,0xc4,0x28,0x45,0x31,0xc9,0x4c,0x8d,0x05,0x1f,0x00,0x00,
    0x00,0x31,0xc9,0x5b,0x48,0x8d,0x15,0x1d,0x00,0x00,0x00,0x5e,0x5f,0x5d,0x41,0xff,
    0xe2,0x45,0x31,0xd2,0xeb,0xdd,0x8b,0x04,0x25,0x3c,0x00,0x00,0x00,0x0f,0x0b,0x90,
    0x4d,0x65,0x73,0x73,0x61,0x67,0x65,0x00,0x48,0x65,0x6c,0x6c,0x6f,0x00,0x00,0x00,
    0x55,0x73,0x65,0x72,0x33,0x32,0x2e,0x64,0x6c,0x6c,0x00
};

int main(int argc, char* argv[])
{
    BYTE* memory = (BYTE*)VirtualAlloc(0, sizeof(shellcode), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
    if (memory == NULL)
        return 0;
    memcpy(memory, shellcode, sizeof(shellcode));

    return (*(int(*)())(&memory[0]))();
}
